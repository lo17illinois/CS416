<!DOCTYPE html>
<html>
<head>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style>
        circle {
            fill: lightblue;
            stroke: black;
        }
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }
        .line-secondary {
            fill: none;
            stroke: orange;
            stroke-width: 2px;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body onload='init()'>
<svg width="800" height="500"></svg>
<p id="status"></p>
<div id="data-table"></div>
<script>
async function init() {
    try {
        const gdpData = await d3.csv('GDP_cleaned.csv', d => {
            return {
                Date_GDP: d3.timeParse("%m/%d/%Y")(d.Date),
                PrivateConsumption: +d.PrivateConsumption
            };
        });

        const inboundData = await d3.csv('Inbound_cleaned2.csv', d => {
            return {
                Date_Inbound: d3.timeParse("%m/%d/%Y")(d.Date),
                GrandTotal: +d['Grand Total']
            };
        });

        const svg = d3.select('svg'),
            margin = {top: 20, right: 60, bottom: 30, left: 50},
            width = +svg.attr('width') - margin.left - margin.right,
            height = +svg.attr('height') - margin.top - margin.bottom,
            g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

        const x = d3.scaleTime().rangeRound([0, width]),
            yLeft = d3.scaleLinear().rangeRound([height, 0]),
            yRight = d3.scaleLinear().rangeRound([height, 0]);

        const lineGDP = d3.line()
            .x(d => x(d.Date_GDP))
            .y(d => yLeft(d.PrivateConsumption));

        const lineInbound = d3.line()
            .x(d => x(d.Date_Inbound))
            .y(d => yRight(d.GrandTotal));

        const allDates = gdpData.map(d => d.Date_GDP).concat(inboundData.map(d => d.Date_Inbound));
        x.domain(d3.extent(allDates));
        yLeft.domain(d3.extent(gdpData, d => d.PrivateConsumption));
        yRight.domain(d3.extent(inboundData, d => d.GrandTotal));

        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));

        g.append('g')
            .call(d3.axisLeft(yLeft))
            .append('text')
            .attr('fill', '#000')
            .attr('transform', 'rotate(-90)')
            .attr('y', 6)
            .attr('dy', '0.71em')
            .attr('text-anchor', 'end')
            .text('Private Consumption');

        g.append('g')
            .attr('transform', `translate(${width},0)`)
            .call(d3.axisRight(yRight))
            .append('text')
            .attr('fill', '#000')
            .attr('transform', 'rotate(-90)')
            .attr('y', -12)
            .attr('dy', '0.71em')
            .attr('text-anchor', 'end')
            .text('Grand Total');

        g.append('path')
            .datum(gdpData)
            .attr('class', 'line')
            .attr('d', lineGDP);

        g.append('path')
            .datum(inboundData)
            .attr('class', 'line-secondary')
            .attr('d', lineInbound);

        document.getElementById('status').textContent = 'Data loaded successfully!';

        // Display the first 10 rows of data for both datasets
        const table = d3.select('#data-table').append('table');
        const thead = table.append('thead');
        const tbody = table.append('tbody');

        thead.append('tr')
            .selectAll('th')
            .data(['Date_GDP', 'Private Consumption', 'Date_Inbound', 'Grand Total'])
            .enter()
            .append('th')
            .text(d => d);

        // Merge data for table display
        const mergedData = d3.merge([gdpData.map(d => ({ ...d, type: 'GDP' })), inboundData.map(d => ({ ...d, type: 'Inbound' }))])
            .sort((a, b) => a.Date_GDP - b.Date_GDP || a.Date_Inbound - b.Date_Inbound);
        
        const rows = tbody.selectAll('tr')
            .data(mergedData.slice(0, 10))
            .enter()
            .append('tr');

        rows.selectAll('td')
            .data(d => [
                d.Date_GDP ? d3.timeFormat("%Y-%m-%d")(d.Date_GDP) : 'N/A',
                d.PrivateConsumption !== undefined ? d.PrivateConsumption : 'N/A',
                d.Date_Inbound ? d3.timeFormat("%Y-%m-%d")(d.Date_Inbound) : 'N/A',
                d.GrandTotal !== undefined ? d.GrandTotal : 'N/A'
            ])
            .enter()
            .append('td')
            .text(d => d);

    } catch (error) {
        console.error(error);
        document.getElementById('status').textContent = 'Error loading data';
    }
}
</script>
</body>
</html>
