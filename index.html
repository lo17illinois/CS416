<!DOCTYPE html>
<html>
<head>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style>
        circle {
            fill: lightblue;
            stroke: black;
        }
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }
        .line-secondary {
            fill: none;
            stroke: orange;
            stroke-width: 2px;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body onload='init()'>
<svg width="800" height="500"></svg>
<p id="status"></p>
<div id="data-table-gdp"></div>
<div id="data-table-inbound"></div>
<script>
async function init() {
    try {
        const data = await d3.csv('JapanTourism.csv', d => {
            return {
                Date: d3.timeParse("%m/%d/%Y")(d.Date),
                Inbound: +d.Inbound,
                Outbound: +d.Outbound,
                GDP: +d.GDP,
                USDJPY: +d.USDJPY
            };
        });

        const svg = d3.select('svg'),
            margin = {top: 20, right: 60, bottom: 30, left: 50},
            width = +svg.attr('width') - margin.left - margin.right,
            height = +svg.attr('height') - margin.top - margin.bottom,
            g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
        const x = d3.scaleTime().rangeRound([0, width]),
            yLeft = d3.scaleLinear().rangeRound([height, 0]),
            yRight = d3.scaleLinear().rangeRound([height, 0]);
        const lineInbound = d3.line()
            .x(d => x(d.Date))
            .y(d => yLeft(d.Inbound));
        const lineGDP = d3.line()
            .x(d => x(d.Date))
            .y(d => yRight(d.InBound));

        yLeft.domain(d3.extent(gdpData, d => d.PrivateConsumption));
        yRight.domain(d3.extent(inboundData, d => d.GrandTotal));

        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x));

        g.append('g')
            .call(d3.axisLeft(yLeft))
            .append('text')
            .attr('fill', '#000')
            .attr('transform', 'rotate(-90)')
            .attr('y', 6)
            .attr('dy', '0.71em')
            .attr('text-anchor', 'end')
            .text('Private Consumption');

        g.append('g')
            .attr('transform', `translate(${width},0)`)
            .call(d3.axisRight(yRight))
            .append('text')
            .attr('fill', '#000')
            .attr('transform', 'rotate(-90)')
            .attr('y', -12)
            .attr('dy', '0.71em')
            .attr('text-anchor', 'end')
            .text('Grand Total');

        g.append('path')
            .datum(gdpData)
            .attr('class', 'line')
            .attr('d', lineGDP);

        g.append('path')
            .datum(inboundData)
            .attr('class', 'line-secondary')
            .attr('d', lineInbound);

        document.getElementById('status').textContent = 'Data loaded successfully';

    } catch (error) {
        console.error(error);
        document.getElementById('status').textContent = 'Error loading data';
    }
}
</script>
</body>
</html>
