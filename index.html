<!DOCTYPE html>
<html>
<head>
    <script src='https://d3js.org/d3.v5.min.js'></script>
    <style>
        circle {
            fill: lightblue;
            stroke: black;
        }
        .line {
            fill: none;
            stroke: steelblue;
            stroke-width: 2px;
        }
        table {
            margin-top: 20px;
            border-collapse: collapse;
            width: 100%;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
    </style>
</head>
<body onload='init()'>
<svg width="800" height="500"></svg>
<p id="status"></p>
<div id="data-table"></div>
<script>
async function init() {
    try {
        const data = await d3.csv('GDP_cleaned.csv', d => {
            return {
                Date: d3.timeParse("%m/%d/%Y")(d.Date),
                PrivateConsumption: +d.PrivateConsumption
            };
        });

        // Debugging: Log the first few rows of data to check date parsing
        console.log("Data loaded:", data.slice(0, 5));

        // Check if the dates are parsed correctly
        data.forEach(d => {
            if (isNaN(d.Date)) {
                console.error("Date parsing error:", d);
            }
        });

        const svg = d3.select('svg'),
            margin = {top: 20, right: 20, bottom: 30, left: 50},
            width = +svg.attr('width') - margin.left - margin.right,
            height = +svg.attr('height') - margin.top - margin.bottom,
            g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);

        const x = d3.scaleTime().rangeRound([0, width]),
            y = d3.scaleLinear().rangeRound([height, 0]);

        const line = d3.line()
            .x(d => x(d.Date))
            .y(d => y(d.PrivateConsumption));

        x.domain(d3.extent(data, d => d.Date));
        y.domain(d3.extent(data, d => d.PrivateConsumption));

        g.append('g')
            .attr('transform', `translate(0,${height})`)
            .call(d3.axisBottom(x))
            .select('.domain')
            .remove();

        g.append('g')
            .call(d3.axisLeft(y))
            .append('text')
            .attr('fill', '#000')
            .attr('transform', 'rotate(-90)')
            .attr('y', 6)
            .attr('dy', '0.71em')
            .attr('text-anchor', 'end')
            .text('Private Consumption');

        g.append('path')
            .datum(data)
            .attr('class', 'line')
            .attr('d', line);

        document.getElementById('status').textContent = 'Data loaded successfully!';

        // Display the first 10 rows of data
        const table = d3.select('#data-table').append('table');
        const thead = table.append('thead');
        const tbody = table.append('tbody');

        thead.append('tr')
            .selectAll('th')
            .data(['Date', 'Private Consumption'])
            .enter()
            .append('th')
            .text(d => d);

        const rows = tbody.selectAll('tr')
            .data(data.slice(0, 10))
            .enter()
            .append('tr');

        rows.selectAll('td')
            .data(d => [d.Date, d.PrivateConsumption])
            .enter()
            .append('td')
            .text(d => d instanceof Date ? d3.timeFormat("%Y-%m-%d")(d) : d);

    } catch (error) {
        document.getElementById('status').textContent = 'Error loading data';
    }
}
</script>
</body>
</html>
